<#INCLUDE filename="include_header.html">
<#INCLUDE filename="include_menu.html">
  <div id="content-wrap" class="col-sm-8 col-md-9">
    <div id="content">
		<form action="illiad.dll" method="post" name="ArticleRequest" class="form-horizontal">
			<input type="hidden" name="ILLiadForm" value="ArticleRequest">
			<input type="hidden" name="Username" value="<#PARAM name="Username">">
			<input type="hidden" name="SessionID" value="<#PARAM name="SessionID">">
					<h2>Article Request</h2>
					<#STATUS><br />
					<div>All fields with <span class="req">*</span> must be filled</div>
					<h3>Describe the item you want</h3>
          
          <div class="form-group">
            <label for="DOI" class="col-sm-4 control-label"><span class="<#ERROR name="ERRORDoi">"><b>DOI (Digital Object Identifier)</b></span></label>
            <input class="col-sm-6" id="DOI" class="form-control" name="DOI" type="text" tabindex="1" value="<#PARAM name="DOI">">
            <div class="col-sm-2"><button type="button" class="btn" id="doi-lookup">Get Info</button><span style="display:none;margin-left:5px;" class="fa fa-spinner fa-spin"></span></div>
            <div class="col-sm-8 col-sm-offset-2"><b>If used, some article information will be automatically added</b></div>
            <div class="col-sm-4 col-sm-offset-3 text-center" id="lookup-info"></div>
          </div>
          
          <hr/>
          
          <div class="form-group">
            <label for="PhotoJournalTitle" class="col-sm-4 control-label"><span class="<#ERROR name="ERRORPhotoJournalTitle">"><span class="req">*</span><b>Journal Title</b></span></label>
            <textarea class="col-sm-8" id="PhotoJournalTitle" name="PhotoJournalTitle" rows="2" cols="40" class="f-name" tabindex="2" required><#PARAM name="PhotoJournalTitle"></textarea>
            <div class="col-sm-8 col-sm-offset-4">Please do not abbreviate unless your citation is abbreviated</div>
          </div>
          
          <div class="form-group">
            <label for="PhotoArticleTitle" class="col-sm-4 control-label"><span class="<#ERROR name="ERRORPhotoArticleTitle">"><span class="req">*</span><b>Article Title</b></span></label>
            <textarea class="col-sm-8" id="PhotoArticleTitle" name="PhotoArticleTitle" rows="2" cols="40" class="f-name" tabindex="3" required><#PARAM name="PhotoArticleTitle"></textarea>
          </div>
          
          <div class="form-group">
            <label for="PhotoArticleAuthor" class="col-sm-4 control-label"><span class="<#ERROR name="ERRORPhotoArticleAuthor">"><b>Article Author</b></span></label>
            <input class="col-sm-8" id="PhotoArticleAuthor" class="form-control" name="PhotoArticleAuthor" type="text" tabindex="4" value="<#PARAM name="PhotoArticleAuthor">">
          </div>
          
          <div class="form-group">
            <div class="col-sm-6">
              <label for="PhotoJournalVolume" class="col-xs-4 text-right"><span class="<#ERROR name="ERRORPhotoJournalVolume">"><span class="req">*</span><b>Volume</b></span></label>
              <input class="col-sm-8" id="PhotoJournalVolume" class="form-control" name="PhotoJournalVolume" type="text" tabindex="4" required value="<#PARAM name="PhotoJournalVolume">">
            </div>
            <div class="col-sm-6">
              <label for="PhotoJournalIssue" class="col-xs-4 text-right"><span class="<#ERROR name="ERRORPhotoJournalIssue">"><span class="req">*</span><b>Issue Number</b></span></label>
              <input class="col-sm-8" id="PhotoJournalIssue" class="form-control" name="PhotoJournalIssue" type="text" tabindex="4" required value="<#PARAM name="PhotoJournalIssue">">
            </div>
            <div class="col-sm-3 col-sm-offset-2">
              If not known write "--".
            </div>
            <div class="col-sm-3 col-sm-offset-3 hidden-xs">
              If not known write "--".
            </div>
          </div>
          
          <div class="form-group">
            <div class="col-sm-6">
              <label for="PhotoJournalYear" class="col-xs-4 text-right"><span class="<#ERROR name="ERRORPhotoJournalYear">"><span class="req">*</span><b>Year</b></span></label>
              <input class="col-sm-8" id="PhotoJournalYear" class="form-control" name="PhotoJournalYear" type="text" tabindex="4" required value="<#PARAM name="PhotoJournalYear">">
            </div>
            <div class="col-sm-6">
              <label for="PhotoJournalMonth" class="col-xs-4 text-right"><span class="<#ERROR name="ERRORPhotoJournalMonth">"><b>Month</b></span></label>
              <input class="col-sm-8" id="PhotoJournalMonth" class="form-control" name="PhotoJournalMonth" type="text" tabindex="4" value="<#PARAM name="PhotoJournalMonth">">
            </div>
          </div>
          
          <div class="form-group">
            <div class="col-sm-6">
              <label for="PhotoJournalInclusivePages" class="col-xs-4 text-right"><span class="<#ERROR name="ERRORPhotoJournalInclusivePages">"><span class="req">*</span><b>Inclusive Pages</b></span></label>
              <input class="col-sm-8" id="PhotoJournalInclusivePages" class="form-control" name="PhotoJournalInclusivePages" type="text" tabindex="4" required value="<#PARAM name="PhotoJournalInclusivePages">">
            </div>
            <div class="col-sm-6">
              <label for="ISSN" class="col-xs-4 text-right"><span class="<#ERROR name="ERRORISSN">"><b>ISSN</b></span></label>
              <input class="col-sm-8" id="ISSN" class="form-control" name="ISSN" type="text" tabindex="4" value="<#PARAM name="ISSN">">
            </div>
          </div>
          
          <hr/>
          
          <div class="form-group">
              <label for="NotWantedAfter" class="col-sm-4 text-right"><span class="<#ERROR name="ERRORNotWantedAfter">"><span class="req">*</span><b>Not Wanted After Date</b></span></label>
              <input class="col-sm-8" id="NotWantedAfter" class="form-control" name="NotWantedAfter" type="text" tabindex="4" required value="<#PARAM name="NotWantedAfter">">
          </div>
          
          <div class="form-group">
              <label for="AcceptNonEnglish" class="col-sm-4 text-right"><span class="<#ERROR name="ERRORAcceptNonEnglish">"><b>Language Other Than English?</b></span>
              <br/>
              <span>Specify acceptable languages in the notes field.</span>
              </label>
              <select id="AcceptNonEnglish" name="AcceptNonEnglish" size="1" class="f-name" tabindex="12">
                <option selected><#PARAM name="AcceptNonEnglish"></option>
                <option>No</option>
                <option>Yes</option>
              </select>
          </div>
            
          <hr/>
          
          <div class="form-group">
            <label for="Notes" class="col-sm-12"><span class="<#ERROR name="ERRORNotes">"><b>Notes</b></span>
            <br/>
            <span>Put any information here that may help us find the item, as well as any other pertinent information.</span>
            </label>
            <textarea class="col-sm-12 id="Notes" name="Notes" rows="2" cols="40" class="f-name" tabindex="13"><#PARAM name="Notes"></textarea>
          </div>
            
          <div class="form-group">
            <label for="CitedIn" class="col-sm-12"><span class="<#ERROR name="ERRORCitedIn">"><b>Where did you find this item cited?</b></span>
            <br/>
            <span>Examples are Academic OneFile&reg;, CINAHL&reg;, PsycINFO&reg;, or a specific journal or book.</span>
            </label>
            <textarea class="col-sm-12" id="CitedIn" name="CitedIn" rows="2" cols="40" class="f-name" tabindex="13"><#PARAM name="CitedIn"></textarea>
          </div>
          
          <center>
            <input name="SubmitButton" value="Submit Request" type="hidden"/>
            <input type="submit" value="Submit Request" class="btn" tabindex="60">
          </center>
		</form>		

    </div>    
  </div>
  
  <script>
    $(document).ready(function() {
      $('#NotWantedAfter').datepicker();
      
      function modal(data) {
        var html = '';
        if (data.article.length !== 0) {
          html += '<h3>Article Links</h3>';
          data.article.forEach(function(item, i) {
            if (i > 4) {
              return;
            }
            html += '<p><a href="' + item + '" target="_blank">Go to Article</a></p>';
          });
        }
        if (data.journal.length !== 0 && data.article.length === 0) {
          html += '<h3>Search in these Journals</h3>';
          data.journal.forEach(function(item, i) {
            if (i > 4) {
              return;
            }
            html += '<p><a href="' + item + '" target="_blank">Go to Journal</a></p>';
          });
        }
        $('#confirm-modal').modal().appendTo('body').find('.modal-body');
        $('#article-links').html(html);
      }
    
      $('#doi-lookup').click(function(e) {
        ga('send', 'event', 'lookup', 'click', 'DOI');
        $('#lookup-info').hide();
        var $button = $(e.currentTarget);
        var doi = $('#DOI').val().replace('doi:','').replace('DOI:', '').replace('http://dx.doi.org/', '').trim().replace(/\.+$/, '');
        if (doi === '') {
          return false;
        }
        $button.next('span').show();
        $.ajax({
          url: '//library2.fairfield.edu/api/doi.php',
          data: {q:doi},
          success: function (data) {
            $button.next('span').hide();
            if (data.error) {
              $('#lookup-info').text('Could not find article information').addClass('alert alert-info').show();
              return;
            }
            if (data.links.length > 0) {
              modal({article: data.links, journal: []});
            }
            $('#PhotoArticleAuthor').val(data.author);
            $('#PhotoArticleTitle').val(data.title);
            $('#PhotoJournalYear').val(data.date);
            $('#PhotoJournalVolume').val(data.volume);
            $('#PhotoJournalIssue').val(data.issue);
            $('#ISSN').val(data.issn);
            $('#PhotoJournalTitle').val(data.journal);
            $('#PhotoJournalInclusivePages').val(data.spage);
          }
        });
      });
      
      
      //check before submit
      $('form').submit(function(e) {
        var form = this;
        var data = {
          version: '1.0',
          url_ver: 'Z39.88--2004',
          rft_val_fmt: 'info:ofi/fmt:kev:mtx:journal',
          atitle: $('#PhotoArticleTitle').val(),
          title: $('#PhotoJournalTitle').val(),
          issn: $('#ISSN').val(),
          au: $('#PhotoArticleAuthor').val(),
          volume: $('#PhotoJournalVolume').val(),
          issue: $('#PhotoJournalIssue').val()
        }
        $.ajax({
          url: '//library2.fairfield.edu/api/openurl.php',
          data: data
        }).done(function(data) {
          if (data.article.length === 0 && data.journal.length === 0) {
            form.submit();
          } else {
            modal(data);
          }
        });
        e.preventDefault();
      });
      
      $('#modal-submit').click(function() {
        $('form[name="ArticleRequest"]')[0].submit();
      });
    });
  </script>
  
<div class="modal" id="confirm-modal">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">We May Have That Article!</h4>
      </div>
      <div class="modal-body">
        <p>Please check out these links before submitting:</p>
        <div id="article-links"></div>
      </div>
      <div class="modal-footer">
        <span>
        <button type="button" class="btn btn-default" data-dismiss="modal" style="margin-bottom:0">Close</button>
        <button type="button" class="btn btn-primary" id="modal-submit">Submit Request</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->


<#INCLUDE filename="include_footer.html">